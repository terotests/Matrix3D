(function(){var t={},i=function(){!function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){this._data={m00:1,m01:0,m02:0,m03:0,m10:0,m11:1,m12:0,m13:0,m20:0,m21:0,m22:1,m23:0,m30:0,m31:0,m32:0,m33:1}}),t.m00=function(t){return"undefined"!=typeof t?(this._data.m00!=t&&(this._dirty=!0),this._data.m00=t,this):this._data.m00},t.m01=function(t){return"undefined"!=typeof t?(this._data.m01!=t&&(this._dirty=!0),this._data.m01=t,this):this._data.m01},t.m02=function(t){return"undefined"!=typeof t?(this._data.m02!=t&&(this._dirty=!0),this._data.m02=t,this):this._data.m02},t.m03=function(t){return"undefined"!=typeof t?(this._data.m03!=t&&(this._dirty=!0),this._data.m03=t,this):this._data.m03},t.m10=function(t){return"undefined"!=typeof t?(this._data.m10!=t&&(this._dirty=!0),this._data.m10=t,this):this._data.m10},t.m11=function(t){return"undefined"!=typeof t?(this._data.m11!=t&&(this._dirty=!0),this._data.m11=t,this):this._data.m11},t.m12=function(t){return"undefined"!=typeof t?(this._data.m12!=t&&(this._dirty=!0),this._data.m12=t,this):this._data.m12},t.m13=function(t){return"undefined"!=typeof t?(this._data.m13!=t&&(this._dirty=!0),this._data.m13=t,this):this._data.m13},t.m20=function(t){return"undefined"!=typeof t?(this._data.m20!=t&&(this._dirty=!0),this._data.m20=t,this):this._data.m20},t.m21=function(t){return"undefined"!=typeof t?(this._data.m21!=t&&(this._dirty=!0),this._data.m21=t,this):this._data.m21},t.m22=function(t){return"undefined"!=typeof t?(this._data.m22!=t&&(this._dirty=!0),this._data.m22=t,this):this._data.m22},t.m23=function(t){return"undefined"!=typeof t?(this._data.m23!=t&&(this._dirty=!0),this._data.m23=t,this):this._data.m23},t.m30=function(t){return"undefined"!=typeof t?(this._data.m30!=t&&(this._dirty=!0),this._data.m30=t,this):this._data.m30},t.m31=function(t){return"undefined"!=typeof t?(this._data.m31!=t&&(this._dirty=!0),this._data.m31=t,this):this._data.m31},t.m32=function(t){return"undefined"!=typeof t?(this._data.m32!=t&&(this._dirty=!0),this._data.m32=t,this):this._data.m32},t.m33=function(t){return"undefined"!=typeof t?(this._data.m33!=t&&(this._dirty=!0),this._data.m33=t,this):this._data.m33}}(this),function(t){var i;t.copyFrom=function(t){var i=t._data;this._data.m00=i.m00,this._data.m01=i.m01,this._data.m02=i.m02,this._data.m03=i.m03,this._data.m10=i.m10,this._data.m11=i.m11,this._data.m12=i.m12,this._data.m13=i.m13,this._data.m20=i.m20,this._data.m21=i.m21,this._data.m22=i.m22,this._data.m23=i.m23,this._data.m30=i.m30,this._data.m31=i.m31,this._data.m32=i.m32,this._data.m33=i.m33},t.createCopy=function(){var t=this.createIdentity();return t.updateFromParams(this.m00(),this.m01(),this.m02(),this.m03(),this.m10(),this.m11(),this.m12(),this.m13(),this.m20(),this.m21(),this.m22(),this.m23(),this.m30(),this.m31(),this.m32(),this.m33()),t},t.createIdentity=function(){return m()},t.createThreeMatrix=function(){var t=new THREE.Matrix4;return t.set(this.m00(),this.m10(),this.m20(),this.m30(),this.m01(),this.m11(),this.m21(),this.m31(),this.m02(),this.m12(),this.m22(),this.m32(),this.m03(),this.m13(),this.m23(),this.m33()),t},t.createTransformCopy=function(){var t=m();return t.m30(this.m30()),t.m31(this.m31()),t.m32(this.m32()),t},t.det=function(){var t=this.m00(),i=this.m01(),m=this.m02(),s=this.m03(),a=this.m10(),n=this.m11(),h=this.m12(),e=this.m13(),r=this.m20(),o=this.m21(),d=this.m22(),u=this.m23(),f=this.m30(),_=this.m31(),c=this.m32(),y=this.m33(),x=t*n-a*i,l=t*o-r*i,p=t*_-f*i,v=a*o-r*n,F=a*_-f*n,z=r*_-f*o,N=m*e-h*s,g=m*u-d*s,w=m*y-c*s,M=h*u-d*e,I=h*y-c*e,C=d*y-c*u;return x*C-l*I+p*M+v*w-F*g+z*N},t.getCSSMatrix3D=function(){i=this.systemHas3D();var t=5;if(i){var m="matrix3d("+this.m00().toFixed(t)+", "+this.m01().toFixed(t)+", "+this.m02().toFixed(t)+", "+this.m03().toFixed(t)+","+this.m10().toFixed(t)+", "+this.m11().toFixed(t)+", "+this.m12().toFixed(t)+", "+this.m13().toFixed(t)+","+this.m20().toFixed(t)+", "+this.m21().toFixed(t)+", "+this.m22().toFixed(t)+", "+this.m23().toFixed(t)+","+this.m30().toFixed(t)+", "+this.m31().toFixed(t)+", "+this.m32().toFixed(t)+", "+this.m33().toFixed(t)+")";return m+";-webkit-transform:"+m+";-ms-transform:"+m+";-webkit-transform-origin:0 0;-ms-transform-origin:0 0;"}var m="matrix("+this.m00().toFixed(t)+", "+this.m01().toFixed(t)+", "+this.m10().toFixed(t)+", "+this.m11().toFixed(t)+", "+this.m30().toFixed(t)+", "+this.m31().toFixed(t)+")";return m+";-webkit-transform:"+m+";-ms-transform:"+m+";-webkit-transform-origin:0 0;-ms-transform-origin:0 0;"},t.getRotation2D=function(){var t,i=this.m00(),m=this.m01();return t=m>=0?Math.acos(i):-1*Math.acos(i)},t.getSVGTransform=function(){return"matrix("+this.m00().toFixed(5)+","+this.m01().toFixed(5)+","+this.m10().toFixed(5)+","+this.m11().toFixed(5)+","+this.m30().toFixed(5)+","+this.m31().toFixed(5)+")"},t.intersectPlane=function(t,i,m){var s=this.normalizeVector3D({x:this.m20(),y:this.m21(),z:this.m22()});if(m)var a={x:m.x-t.x,y:m.y-t.y,z:m.z-t.z};else var a={x:this.m30()-t.x,y:this.m31()-t.y,z:this.m32()-t.z};var n=a.x*s.x+a.y*s.y+a.z*s.z,h={x:i.x-t.x,y:i.y-t.y,z:i.z-t.z},e=h.x*s.x+h.y*s.y+h.z*s.z;if(Math.abs(n)>0&&Math.abs(e)>0){var r=n/e;if(Math.abs(r)>0){var o={x:t.x+h.x*r,y:t.y+h.y*r,z:t.z+h.z*r};return o}}},t.inverse=function(){var t=this.m00(),i=this.m01(),m=this.m02(),s=this.m03(),a=this.m10(),n=this.m11(),h=this.m12(),e=this.m13(),r=this.m20(),o=this.m21(),d=this.m22(),u=this.m23(),f=this.m30(),_=this.m31(),c=this.m32(),y=this.m33(),x=t*n-a*i,l=t*o-r*i,p=t*_-f*i,v=a*o-r*n,F=a*_-f*n,z=r*_-f*o,N=m*e-h*s,g=m*u-d*s,w=m*y-c*s,M=h*u-d*e,I=h*y-c*e,C=d*y-c*u,D=x*C-l*I+p*M+v*w-F*g+z*N;if(0!=D){var b=1/D;return this.m00((n*C-o*I+_*M)*b),this.m01((-i*C+o*w-_*g)*b),this.m02((i*I-n*w+_*N)*b),this.m03((-i*M+n*g-o*N)*b),this.m10((-a*C+r*I-f*M)*b),this.m11((t*C-r*w+f*g)*b),this.m12((-t*I+a*w-f*N)*b),this.m13((t*M-a*g+r*N)*b),this.m20((e*z-u*F+y*v)*b),this.m21((-s*z+u*p-y*l)*b),this.m22((s*F-e*p+y*x)*b),this.m23((-s*v+e*l-u*x)*b),this.m30((-h*z+d*F-c*v)*b),this.m31((m*z-d*p+c*l)*b),this.m32((-m*F+h*p-c*x)*b),this.m33((m*v-h*l+d*x)*b),this}},t.isValidMatrix=function(){var t=this._data;return isNaN(t.m00)?!1:isNaN(t.m01)?!1:isNaN(t.m02)?!1:isNaN(t.m03)?!1:isNaN(t.m10)?!1:isNaN(t.m11)?!1:isNaN(t.m12)?!1:isNaN(t.m13)?!1:isNaN(t.m20)?!1:isNaN(t.m21)?!1:isNaN(t.m22)?!1:isNaN(t.m23)?!1:isNaN(t.m30)?!1:isNaN(t.m31)?!1:isNaN(t.m32)?!1:isNaN(t.m33)?!1:!0},t.log=function(){console.log(this._data)},t.matMul=function(t){var i=this.m00(),m=this.m01(),s=this.m02(),a=this.m03(),n=this.m10(),h=this.m11(),e=this.m12(),r=this.m13(),o=this.m20(),d=this.m21(),u=this.m22(),f=this.m23(),_=this.m30(),c=this.m31(),y=this.m32(),x=this.m33(),l=t.m00(),p=t.m01(),v=t.m02(),F=t.m03(),z=t.m10(),N=t.m11(),g=t.m12(),w=t.m13(),M=t.m20(),I=t.m21(),C=t.m22(),D=t.m23(),b=t.m30(),P=t.m31(),T=t.m32(),V=t.m33();return this.updateFromParams(i*l+n*p+o*v+_*F,m*l+h*p+d*v+c*F,s*l+e*p+u*v+y*F,a*l+r*p+f*v+x*F,i*z+n*N+o*g+_*w,m*z+h*N+d*g+c*w,s*z+e*N+u*g+y*w,a*z+r*N+f*g+x*w,i*M+n*I+o*C+_*D,m*M+h*I+d*C+c*D,s*M+e*I+u*C+y*D,a*M+r*I+f*C+x*D,i*b+n*P+o*T+_*V,m*b+h*P+d*T+c*V,s*b+e*P+u*T+y*V,a*b+r*P+f*T+x*V),this},t.normalize=function(){this.copyFrom(new m)},t.normalizeVector3D=function(t){var i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return 0==i||isNaN(i)?{x:1,y:0,z:0}:{x:t.x/i,y:t.y/i,z:t.z/i}},t.projectVector=function(t){var i=this.m00(),m=this.m01(),s=this.m02(),a=this.m03(),n=this.m10(),h=this.m11(),e=this.m12(),r=this.m13(),o=this.m20(),d=this.m21(),u=this.m22(),f=this.m23(),_=this.m30(),c=this.m31(),y=this.m32(),x=this.m33();return{x:i*t.x+n*t.y+o*t.z+_*t.w,y:m*t.x+h*t.y+d*t.z+c*t.w,z:s*t.x+e*t.y+u*t.z+y*t.w,w:a*t.x+r*t.y+f*t.z+x*t.w}},t.rotate=function(t,i){var t=this.normalizeVector3D(t),m=t.x,s=t.y,a=t.z,n=Math.cos(i),h=Math.sin(i);this.updateFromParams(n+m*m*(1-n),s*m*(1-n)+a*h,a*m*(1-n)-s*h,0,s*m*(1-n)-a*h,n+s*s*(1-n),a*s*(1-n)+m*h,0,a*m*(1-n)+s*h,s*a*(1-n)-m*h,n+a*a*(1-n),0,0,0,0,1)},t.scale=function(t){return this.updateFromParams(t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1),this},t.screenProjection=function(t,i){var m=this.projectVector(t);if(!i.d)return a=m.x,n=m.y,{x:a,y:n};var s=i.d-m.z,a=m.x-(i.cx||500),n=m.y-(i.cy||500);return s>0?{x:i.cx+a*i.d/s,y:i.cy+n*i.d/s}:void 0},t.setCanvasContext=function(t){t.setTransform(this.m00(),this.m01(),this.m10(),this.m11(),this.m30(),this.m31())},t.setDomContext=function(t){this.setCanvasContext(t)},t.systemHas3D=function(t){if("undefined"!=typeof i)return i;if("undefined"==typeof window)return!1;if(!window.getComputedStyle)return!1;var m,s=document.createElement("p"),a={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(s,null);for(var t in a)void 0!==s.style[t]&&(s.style[t]="translate3d(1px,1px,1px)",m=window.getComputedStyle(s).getPropertyValue(a[t]));return document.body.removeChild(s),void 0!==m&&m.length>0&&"none"!==m},t.translate=function(t){this.updateFromParams(1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1)},t.updateFromParams=function(){var t=this._data,i=0;t.m00=arguments[i++],t.m01=arguments[i++],t.m02=arguments[i++],t.m03=arguments[i++],t.m10=arguments[i++],t.m11=arguments[i++],t.m12=arguments[i++],t.m13=arguments[i++],t.m20=arguments[i++],t.m21=arguments[i++],t.m22=arguments[i++],t.m23=arguments[i++],t.m30=arguments[i++],t.m31=arguments[i++],t.m32=arguments[i++],t.m33=arguments[i++]}}(this)},m=function(t,i,s,a,n,h,e,r){var o,d=this;if(!(d instanceof m))return new m(t,i,s,a,n,h,e,r);var u=[t,i,s,a,n,h,e,r];if(d.__factoryClass)if(d.__factoryClass.forEach(function(t){o=t.apply(d,u)}),"function"==typeof o){if(o._classInfo.name!=m._classInfo.name)return new o(t,i,s,a,n,h,e,r)}else if(o)return o;d.__traitInit?d.__traitInit.forEach(function(t){t.apply(d,u)}):"function"==typeof d.init&&d.init.apply(d,u)};m._classInfo={name:"Matrix3D"},m.prototype=new i,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.Matrix3D=m,this.Matrix3D=m):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.Matrix3D=m:this.Matrix3D=m}.call(new Function("return this")()),"undefined"!=typeof define&&null!==define&&null!=define.amd&&define(t)}).call(new Function("return this")());