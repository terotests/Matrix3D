(function(){var t={},i=function(){!function(t){var i,s,m;t.addChangeListener=function(t){this._chListeners||(this._chListeners=[]),this._chListeners.push(t)},t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){this._data={m00:1,m01:0,m02:0,m03:0,m10:0,m11:1,m12:0,m13:0,m20:0,m21:0,m22:1,m23:0,m30:0,m31:0,m32:0,m33:1},i||(i={}),this._id=t?"t":this.guid(),"undefined"==typeof later||m?s=!1:(m=!0,later().onFrame(function(){for(var t in i){var s=i[t];s._chListeners&&s._chListeners.forEach(function(t){t(s)}),delete i[t]}}),s=!0)}),t.m00=function(t){return"undefined"!=typeof t?(this._data.m00!=t&&(this._dirty=!0,s&&(i[this._id]=this)),this._data.m00=t,this):this._data.m00},t.m01=function(t){return"undefined"!=typeof t?(this._data.m01!=t&&(this._dirty=!0,s&&(i[this._id]=this)),this._data.m01=t,this):this._data.m01},t.m02=function(t){return"undefined"!=typeof t?(this._data.m02!=t&&(this._dirty=!0,s&&(i[this._id]=this)),this._data.m02=t,this):this._data.m02},t.m03=function(t){return"undefined"!=typeof t?(this._data.m03!=t&&(this._dirty=!0,s&&(i[this._id]=this)),this._data.m03=t,this):this._data.m03},t.m10=function(t){return"undefined"!=typeof t?(this._data.m10!=t&&(this._dirty=!0,s&&(i[this._id]=this)),this._data.m10=t,this):this._data.m10},t.m11=function(t){return"undefined"!=typeof t?(this._data.m11!=t&&(this._dirty=!0,s&&(i[this._id]=this)),this._data.m11=t,this):this._data.m11},t.m12=function(t){return"undefined"!=typeof t?(this._data.m12!=t&&(this._dirty=!0,s&&(i[this._id]=this)),this._data.m12=t,this):this._data.m12},t.m13=function(t){return"undefined"!=typeof t?(this._data.m13!=t&&(this._dirty=!0,s&&(i[this._id]=this)),this._data.m13=t,this):this._data.m13},t.m20=function(t){return"undefined"!=typeof t?(this._data.m20!=t&&(this._dirty=!0,s&&(i[this._id]=this)),this._data.m20=t,this):this._data.m20},t.m21=function(t){return"undefined"!=typeof t?(this._data.m21!=t&&(this._dirty=!0,s&&(i[this._id]=this)),this._data.m21=t,this):this._data.m21},t.m22=function(t){return"undefined"!=typeof t?(this._data.m22!=t&&(this._dirty=!0,s&&(i[this._id]=this)),this._data.m22=t,this):this._data.m22},t.m23=function(t){return"undefined"!=typeof t?(this._data.m23!=t&&(this._dirty=!0,s&&(i[this._id]=this)),this._data.m23=t,this):this._data.m23},t.m30=function(t){return"undefined"!=typeof t?(this._data.m30!=t&&(this._dirty=!0,s&&(i[this._id]=this)),this._data.m30=t,this):this._data.m30},t.m31=function(t){return"undefined"!=typeof t?(this._data.m31!=t&&(this._dirty=!0,s&&(i[this._id]=this)),this._data.m31=t,this):this._data.m31},t.m32=function(t){return"undefined"!=typeof t?(this._data.m32!=t&&(this._dirty=!0,s&&(i[this._id]=this)),this._data.m32=t,this):this._data.m32},t.m33=function(t){return"undefined"!=typeof t?(this._data.m33!=t&&(this._dirty=!0,s&&(i[this._id]=this)),this._data.m33=t,this):this._data.m33},t.onChange=function(t){this._chListeners||(this._chListeners=[]),this._chListeners.push(t)},t.setBatching=function(t){s=t}}(this),function(t){var i;t.applyTransformations=function(t,i,m,a){if(!t._scaleMatrix&&!t._rotMatrix&&!t._transMatrix&&m){var n=m(t);if(n){var r=this;n.forEach(function(t){r.applyTransformations(t,i,m,a)})}}var h=s();if(t._localTransform||(t._localTransform=s()),i=i?i.createCopy():s(),t._lastParentMatrix?t._lastParentMatrix.copyFrom(i):t._lastParentMatrix=i.createCopy(),t._pivotPoint){var e=s();e.translate({x:-1*t._pivotPoint.x,y:-1*t._pivotPoint.y,z:-1*(t._pivotPoint.z||0)})}if(t._transMatrix){h.matMul(t._transMatrix);var o=i.createCopy();o.matMul(t._transMatrix),t._beforeRot=o}if(t._scaleMatrix&&h.matMul(t._scaleMatrix),t._rotMatrix&&h.matMul(t._rotMatrix),e&&h.matMul(e),t._localTransform.copyFrom(h),i.matMul(h),t._renderMatrix||(t._renderMatrix=new s),t._renderMatrix.copyFrom(i),a){var d=a._renderMatrix.createCopy().inverse();d.matMul(t._renderMatrix),t._projectionMatrix||(t._projectionMatrix=new s),t._projectionMatrix.copyFrom(d)}if(m){var n=m(t);if(n){var u=t._renderMatrix,r=this;n.forEach(function(t){r.applyTransformations(t,u,m,a)})}}},t.copyFrom=function(t){var i=t._data;this._data.m00=i.m00,this._data.m01=i.m01,this._data.m02=i.m02,this._data.m03=i.m03,this._data.m10=i.m10,this._data.m11=i.m11,this._data.m12=i.m12,this._data.m13=i.m13,this._data.m20=i.m20,this._data.m21=i.m21,this._data.m22=i.m22,this._data.m23=i.m23,this._data.m30=i.m30,this._data.m31=i.m31,this._data.m32=i.m32,this._data.m33=i.m33},t.createCopy=function(){var t=this.createIdentity();return t.updateFromParams(this.m00(),this.m01(),this.m02(),this.m03(),this.m10(),this.m11(),this.m12(),this.m13(),this.m20(),this.m21(),this.m22(),this.m23(),this.m30(),this.m31(),this.m32(),this.m33()),t},t.createIdentity=function(){return s()},t.createThreeMatrix=function(){var t=new THREE.Matrix4;return t.set(this.m00(),this.m10(),this.m20(),this.m30(),this.m01(),this.m11(),this.m21(),this.m31(),this.m02(),this.m12(),this.m22(),this.m32(),this.m03(),this.m13(),this.m23(),this.m33()),t},t.createTransformCopy=function(){var t=s();return t.m30(this.m30()),t.m31(this.m31()),t.m32(this.m32()),t},t.det=function(){var t=this.m00(),i=this.m01(),s=this.m02(),m=this.m03(),a=this.m10(),n=this.m11(),r=this.m12(),h=this.m13(),e=this.m20(),o=this.m21(),d=this.m22(),u=this.m23(),f=this.m30(),_=this.m31(),c=this.m32(),y=this.m33(),x=t*n-a*i,l=t*o-e*i,p=t*_-f*i,v=a*o-e*n,M=a*_-f*n,F=e*_-f*o,g=s*h-r*m,z=s*u-d*m,N=s*y-c*m,w=r*u-d*h,C=r*y-c*h,P=d*y-c*u;return x*P-l*C+p*w+v*N-M*z+F*g},t.getCSSMatrix3D=function(){i=this.systemHas3D();var t=5;if(i){var s="matrix3d("+this.m00().toFixed(t)+", "+this.m01().toFixed(t)+", "+this.m02().toFixed(t)+", "+this.m03().toFixed(t)+","+this.m10().toFixed(t)+", "+this.m11().toFixed(t)+", "+this.m12().toFixed(t)+", "+this.m13().toFixed(t)+","+this.m20().toFixed(t)+", "+this.m21().toFixed(t)+", "+this.m22().toFixed(t)+", "+this.m23().toFixed(t)+","+this.m30().toFixed(t)+", "+this.m31().toFixed(t)+", "+this.m32().toFixed(t)+", "+this.m33().toFixed(t)+")";return"transform:"+s+";-webkit-transform:"+s+";-ms-transform:"+s+";-webkit-transform-origin:0 0;-ms-transform-origin:0 0;"}var s="matrix("+this.m00().toFixed(t)+", "+this.m01().toFixed(t)+", "+this.m10().toFixed(t)+", "+this.m11().toFixed(t)+", "+this.m30().toFixed(t)+", "+this.m31().toFixed(t)+")";return"transform:"+s+";-webkit-transform:"+s+";-ms-transform:"+s+";-webkit-transform-origin:0 0;-ms-transform-origin:0 0;"},t.getRotation2D=function(){var t,i=this.m00(),s=this.m01();return t=s>=0?Math.acos(i):-1*Math.acos(i)},t.getSVGTransform=function(){return"matrix("+this.m00().toFixed(5)+","+this.m01().toFixed(5)+","+this.m10().toFixed(5)+","+this.m11().toFixed(5)+","+this.m30().toFixed(5)+","+this.m31().toFixed(5)+")"},t.intersectPlane=function(t,i,s){var m=this.normalizeVector3D({x:this.m20(),y:this.m21(),z:this.m22()});if(s)var a={x:s.x-t.x,y:s.y-t.y,z:s.z-t.z};else var a={x:this.m30()-t.x,y:this.m31()-t.y,z:this.m32()-t.z};var n=a.x*m.x+a.y*m.y+a.z*m.z,r={x:i.x-t.x,y:i.y-t.y,z:i.z-t.z},h=r.x*m.x+r.y*m.y+r.z*m.z;if(Math.abs(n)>0&&Math.abs(h)>0){var e=n/h;if(Math.abs(e)>0){var o={x:t.x+r.x*e,y:t.y+r.y*e,z:t.z+r.z*e};return o}}},t.inverse=function(){var t=this.m00(),i=this.m01(),s=this.m02(),m=this.m03(),a=this.m10(),n=this.m11(),r=this.m12(),h=this.m13(),e=this.m20(),o=this.m21(),d=this.m22(),u=this.m23(),f=this.m30(),_=this.m31(),c=this.m32(),y=this.m33(),x=t*n-a*i,l=t*o-e*i,p=t*_-f*i,v=a*o-e*n,M=a*_-f*n,F=e*_-f*o,g=s*h-r*m,z=s*u-d*m,N=s*y-c*m,w=r*u-d*h,C=r*y-c*h,P=d*y-c*u,T=x*P-l*C+p*w+v*N-M*z+F*g;if(0!=T){var b=1/T;return this.m00((n*P-o*C+_*w)*b),this.m01((-i*P+o*N-_*z)*b),this.m02((i*C-n*N+_*g)*b),this.m03((-i*w+n*z-o*g)*b),this.m10((-a*P+e*C-f*w)*b),this.m11((t*P-e*N+f*z)*b),this.m12((-t*C+a*N-f*g)*b),this.m13((t*w-a*z+e*g)*b),this.m20((h*F-u*M+y*v)*b),this.m21((-m*F+u*p-y*l)*b),this.m22((m*M-h*p+y*x)*b),this.m23((-m*v+h*l-u*x)*b),this.m30((-r*F+d*M-c*v)*b),this.m31((s*F-d*p+c*l)*b),this.m32((-s*M+r*p-c*x)*b),this.m33((s*v-r*l+d*x)*b),this}},t.isValidMatrix=function(){var t=this._data;return isNaN(t.m00)?!1:isNaN(t.m01)?!1:isNaN(t.m02)?!1:isNaN(t.m03)?!1:isNaN(t.m10)?!1:isNaN(t.m11)?!1:isNaN(t.m12)?!1:isNaN(t.m13)?!1:isNaN(t.m20)?!1:isNaN(t.m21)?!1:isNaN(t.m22)?!1:isNaN(t.m23)?!1:isNaN(t.m30)?!1:isNaN(t.m31)?!1:isNaN(t.m32)?!1:isNaN(t.m33)?!1:!0},t.log=function(){console.log(this._data)},t.matMul=function(t){var i=this.m00(),s=this.m01(),m=this.m02(),a=this.m03(),n=this.m10(),r=this.m11(),h=this.m12(),e=this.m13(),o=this.m20(),d=this.m21(),u=this.m22(),f=this.m23(),_=this.m30(),c=this.m31(),y=this.m32(),x=this.m33(),l=t.m00(),p=t.m01(),v=t.m02(),M=t.m03(),F=t.m10(),g=t.m11(),z=t.m12(),N=t.m13(),w=t.m20(),C=t.m21(),P=t.m22(),T=t.m23(),b=t.m30(),I=t.m31(),D=t.m32(),L=t.m33();return this.updateFromParams(i*l+n*p+o*v+_*M,s*l+r*p+d*v+c*M,m*l+h*p+u*v+y*M,a*l+e*p+f*v+x*M,i*F+n*g+o*z+_*N,s*F+r*g+d*z+c*N,m*F+h*g+u*z+y*N,a*F+e*g+f*z+x*N,i*w+n*C+o*P+_*T,s*w+r*C+d*P+c*T,m*w+h*C+u*P+y*T,a*w+e*C+f*P+x*T,i*b+n*I+o*D+_*L,s*b+r*I+d*D+c*L,m*b+h*I+u*D+y*L,a*b+e*I+f*D+x*L),this},t.normalize=function(){this.copyFrom(new s)},t.normalizeVector3D=function(t){var i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return 0==i||isNaN(i)?{x:1,y:0,z:0}:{x:t.x/i,y:t.y/i,z:t.z/i}},t.projectVector=function(t){var i=this.m00(),s=this.m01(),m=this.m02(),a=this.m03(),n=this.m10(),r=this.m11(),h=this.m12(),e=this.m13(),o=this.m20(),d=this.m21(),u=this.m22(),f=this.m23(),_=this.m30(),c=this.m31(),y=this.m32(),x=this.m33();return{x:i*t.x+n*t.y+o*t.z+_*t.w,y:s*t.x+r*t.y+d*t.z+c*t.w,z:m*t.x+h*t.y+u*t.z+y*t.w,w:a*t.x+e*t.y+f*t.z+x*t.w}},t.rotate=function(t,i){var t=this.normalizeVector3D(t),s=t.x,m=t.y,a=t.z,n=Math.cos(i),r=Math.sin(i);return this.updateFromParams(n+s*s*(1-n),m*s*(1-n)+a*r,a*s*(1-n)-m*r,0,m*s*(1-n)-a*r,n+m*m*(1-n),a*m*(1-n)+s*r,0,a*s*(1-n)+m*r,m*a*(1-n)-s*r,n+a*a*(1-n),0,0,0,0,1),this},t.scale=function(t){return this.updateFromParams(t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1),this},t.screenProjection=function(t,i){var s=this.projectVector(t);if(!i.d)return a=s.x,n=s.y,{x:a,y:n};var m=i.d-s.z,a=s.x-(i.cx||500),n=s.y-(i.cy||500);return m>0?{x:i.cx+a*i.d/m,y:i.cy+n*i.d/m}:void 0},t.setCanvasContext=function(t){t.setTransform(this.m00(),this.m01(),this.m10(),this.m11(),this.m30(),this.m31())},t.setDomContext=function(t){this.setCanvasContext(t)},t.systemHas3D=function(t){if("undefined"!=typeof i)return i;if("undefined"==typeof window)return!1;if(!window.getComputedStyle)return!1;var s,m=document.createElement("p"),a={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(m,null);for(var t in a)void 0!==m.style[t]&&(m.style[t]="translate3d(1px,1px,1px)",s=window.getComputedStyle(m).getPropertyValue(a[t]));return document.body.removeChild(m),void 0!==s&&s.length>0&&"none"!==s},t.translate=function(t){return this.updateFromParams(1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1),this},t.updateFromParams=function(){var t=this._data,i=0;t.m00=arguments[i++],t.m01=arguments[i++],t.m02=arguments[i++],t.m03=arguments[i++],t.m10=arguments[i++],t.m11=arguments[i++],t.m12=arguments[i++],t.m13=arguments[i++],t.m20=arguments[i++],t.m21=arguments[i++],t.m22=arguments[i++],t.m23=arguments[i++],t.m30=arguments[i++],t.m31=arguments[i++],t.m32=arguments[i++],t.m33=arguments[i++]}}(this)},s=function(t,i,m,a,n,r,h,e){var o,d=this;if(!(d instanceof s))return new s(t,i,m,a,n,r,h,e);var u=[t,i,m,a,n,r,h,e];if(d.__factoryClass)if(d.__factoryClass.forEach(function(t){o=t.apply(d,u)}),"function"==typeof o){if(o._classInfo.name!=s._classInfo.name)return new o(t,i,m,a,n,r,h,e)}else if(o)return o;d.__traitInit?d.__traitInit.forEach(function(t){t.apply(d,u)}):"function"==typeof d.init&&d.init.apply(d,u)};s._classInfo={name:"Matrix3D"},s.prototype=new i,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.Matrix3D=s,this.Matrix3D=s):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.Matrix3D=s:this.Matrix3D=s}.call(new Function("return this")()),"undefined"!=typeof define&&null!==define&&null!=define.amd&&define(t)}).call(new Function("return this")());